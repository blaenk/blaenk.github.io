<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GDB - Blaenk Denum</title>
  <meta name="author" content="Jorge Israel Peña">
  <meta name="description" content="AKA Blaenk Denum">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/favicon.png" rel="shortcut icon">
  <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Merriweather:900italic,900,700italic,400italic,700,400,300italic,300' rel='stylesheet' type='text/css'>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='/css/screen.css' rel='stylesheet' type='text/css' />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured"></script>
  <script src="https://rawgit.com/ekalinin/typogr.js/master/typogr.min.js"></script>
  <script src='/js/blaenk.js' type='text/javascript'></script>
</head>
<body>
  <div class="page-wrapper">
    <header id="header">
  <div id="stamp">
    <h1 id="name">
      <a href="/">
        <span class="emboldened">Jorge</span>.Israel.<span class="emboldened">Peña</span>
      </a>
    </h1>
    <h4 id="pseudonym">
      AKA <span class="emboldened">Blaenk</span>.Denum
    </h4>
  </div>
  <nav id="main-nav">
    <ul class="main">
      <li><a href="/about/">About</a></li>
      <li><a href="/notes/">Notes</a></li>
      <li><a href="/work/">Work</a></li>
      <li><a href="/lately/">Lately</a></li>
      <li><a id="search_btn">Search</a></li>
    </ul>
  </nav>
  <nav id="mobile-nav">
    <div class="menu">
      <a class="button">Menu</a>
      <div class="container">
        <ul class="main">
          <li><a href="/about/">About</a></li>
          <li><a href="/notes/">Notes</a></li>
          <li><a href="/work/">Work</a></li>
          <li><a href="/lately/">Lately</a></li>
        </ul>
      </div>
    </div>
    <div class="search">
      <a class="button"></a>
      <div class="container">
        <form action="http://google.com/search" method="get">
          <input type="text" name="q" results="0">
          <input type="hidden" name="q" value="site:blaenkdenum.com">
        </form>
      </div>
    </div>
  </nav>
</header>
<form class="desk_search" action="http://google.com/search" method="get">
  <input id="search" type="text" name="q" results="0" placeholder="Search" autocomplete="off" spellcheck="false">
  <input type="hidden" name="q" value="site:blaenkdenum.com">
</form>

    
        <article class="post">
  <h2 class="title"><a href="/notes/gdb"><span>GDB</span></a></h2>
  <div class="entry-content"><p>It seems that using a debugger like the <a href="GDB">GNU Debugger</a> has become something of a lost art for the generation of developers whom are more involved with higher-level languages. Instead, it seems many people resort to so-called <code>printf</code>-debugging, where one places print statements all over the place to sort of trace the state of the program&#39;s execution at any given moment. Of course, this is very tedious, and can be done more naturally and efficiently with a dedicated debugger.</p>

<p>This notes page covers GDB&#39;s native interface in particular, although there are a couple of interfaces such as <a href="http://cgdb.github.io/">cgdb</a>, a lightweight interface with vim binds, as well as <a href="https://www.gnu.org/software/ddd/">DDD</a>, which is a more general-purpose debugging interface.</p>

<p>Aside from GDB there&#39;s also <a href="http://lldb.llvm.org/">LLDB</a> to keep an eye on, which is the LLVM project&#39;s very own debugger. A <a href="http://lldb.llvm.org/tutorial.html">tutorial</a> is available, as well as a table listing the <a href="http://lldb.llvm.org/lldb-gdb.html">LLDB equivalents</a> for various GDB commands.</p>

<p>Remember that, when debugging, it&#39;s best if a program is built with a symbol table---the list of memory addresses corresponding to the program&#39;s variables and lines of code---by passing the <code>-g</code> parameter to gcc or clang.</p>

<p>For an additional resource, RMS&#39; own <a href="http://www.unknownroad.com/rtfm/gdbtut/">tutorial</a> on GDB is available, as well as this <a href="http://rsquared.sdf.org/gdb/">very good guide</a>.</p>

<p>The GDB session samples provided in this page are highlighted with a basic GDB <a href="https://github.com/snarez/gdb_lexer">Pygments lexer</a> I found on github from user snarez, which I then customized a bit.</p>

<nav id="toc">
<h3>Contents</h3><ol>
<li>
<a href="#workflow">Workflow</a>
<ol>
<li>
<a href="#session">Session</a>
</li>
</ol>
</li>
<li>
<a href="#breakpoints">Breakpoints</a>
<ol>
<li>
<a href="#deleting">Deleting</a>
</li>
<li>
<a href="#disabling">Disabling</a>
</li>
<li>
<a href="#conditionals">Conditionals</a>
</li>
<li>
<a href="#command-lists">Command Lists</a>
</li>
<li>
<a href="#watchpoints">Watchpoints</a>
</li>
<li>
<a href="#signals">Signals</a>
</li>
<li>
<a href="#information">Information</a>
</li>
</ol>
</li>
<li>
<a href="#executing">Executing</a>
<ol>
<li>
<a href="#stepping">Stepping</a>
</li>
<li>
<a href="#resuming">Resuming</a>
</li>
</ol>
</li>
<li>
<a href="#inspecting">Inspecting</a>
<ol>
<li>
<a href="#source">Source</a>
</li>
<li>
<a href="#printing">Printing</a>
</li>
<li>
<a href="#call-stack-navigation">Call Stack Navigation</a>
</li>
<li>
<a href="#setting">Setting</a>
</li>
</ol>
</li>
<li>
<a href="#core-files">Core Files</a>
</li>
<li>
<a href="#threads">Threads</a>
</li>
<li>
<a href="#abbreviations">Abbreviations</a>
</li>
<li>
<a href="#valgrind">Valgrind</a>
</li>
</ol>
</nav>
<h1 id="workflow">
<span class="hash">#</span>
<a href="#workflow" class="header-link">Workflow</a>
</h1>
<p>GDB is usually started by passing it the name of the program we want to debug:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>gdb program_to_debug
</code></pre></figure>
<p>Processes with curses-like interfaces can be debugged by running them in a separate terminal and then attaching to them with the <code>-p</code> switch (or using the <code>attach</code> command):</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>gdb -p PID
<span class="c"># or</span>
<span class="nv">$ </span>gdb programname PID
</code></pre></figure>
<p>Another thing that can be done is to run GDB and tell it that the program should be run on a different terminal. This is accomplished with the <code>tty</code> command. For example, assuming the program should be on <code>/dev/pts/8</code>---perhaps because we have another window paired with that pseudoterminal---we would run the following:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">tty</span> /dev/pts/<span class="mh">8</span>
</code></pre></figure>
<p>Then the following should be entered so that the keyboard input to the window will go to the program rather than to the shell, by making the shell go to sleep:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>sleep 100000
</code></pre></figure>
<p>Entering nothing at this prompt re-runs the previous command, which is very useful when stepping with <code>next</code>.</p>

<p>It&#39;s common to then place a temporary breakpoint on <code>main</code> as an entrypoint into the debugging session with <code>tbreak main</code>.</p>

<p>The program is then run with the <code>run</code> command, passing it the appropriate program arguments. The program&#39;s execution will be paused at each breakpoint:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">run</span> arg<span class="mh">1</span> arg<span class="mh">2</span>
Starting program: /path/to/program_to_debug arg<span class="mh">1</span> arg<span class="mh">2</span>

Breakpoint <span class="mh">1</span>, function_containing_breakpoint(ac<span class="o">=</span><span class="mh">4</span>, av<span class="o">=</span><span class="mh">0xbffff094</span>) at src.c:<span class="mh">16</span>
</code></pre></figure>
<p>If the program was previously run, the arguments passed to the previous <code>run</code> can be reused by simply entering <code>run</code> on its own. If the program is already running, GDB will ask if it should restart the program.</p>

<p>GDB is focused on one file at any given moment, which is the file that will be looked for when given parameters without specifying the file name, such as breaking by line number or function name. The first focused file is the one with the <code>main</code> entry point, but the file focus is changed whenever the <code>list</code> command is run, when one steps into code residing on a different file, or when hitting a breakpoint from a separate source file.</p>
<h2 id="session">
<span class="hash">#</span>
<a href="#session" class="header-link">Session</a>
</h2>
<p>It&#39;s normal to keep a GDB session to open during the debugging session. As bugs are fixed and the program is recompiled, GDB will detect the changes and load them in. Breakpoints and other information specified in ways not dependent on line numbers should continue to work.</p>

<p>However, if exiting is necessary, the commands entered can be saved to a GDB startup file of name <code>.gdbinit</code>. This can then be loaded when GDB loads with:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>gdb -command<span class="o">=</span>.gdbinit program
</code></pre></figure>
<p>Breakpoints can be saved to a file with:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">save</span> breakpoints filename
<span class="kt">(gdb)</span> <span class="nb">source</span> filename
</code></pre></figure>
<p>History can be saved by putting this in <code>~/.gdbinit</code>:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-text">set history filename ~/.gdb_history
set history save
</code></pre></figure><h1 id="breakpoints">
<span class="hash">#</span>
<a href="#breakpoints" class="header-link">Breakpoints</a>
</h1>
<p>Breakpoints, set with the <code>break</code> command, pause execution of the program just before that line of code executes.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> function
<span class="kt">(gdb)</span> <span class="nb">break</span> line
<span class="kt">(gdb)</span> <span class="nb">break</span> file:line
<span class="kt">(gdb)</span> <span class="nb">break</span> file:function
</code></pre></figure>
<p>It&#39;s also possible to set a breakpoint relative to the currently executing line of course code in the currently selected stack frame:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> +offset
<span class="kt">(gdb)</span> <span class="nb">break</span> -offset
</code></pre></figure>
<p>It&#39;s also possible to set a breakpoint at a specific virtual memory address, which is useful when there are no debugging symbols:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> *address
</code></pre></figure>
<p>If breaking based on the function name, a breakpoint is applied for every function with that name, which can be troublesome in C++ which allows function overloading. It&#39;d be necessary to disambiguate by line number or file path.</p>

<p>A temporary breakpoint, set with the <code>tbreak</code> command, is one that operates just like a regular breakpoint but it clears itself after the first time it is reached.</p>

<p>Catchpoints are similar to breakpoints and are triggered by things such as thrown and caught exceptions, signals, calls to <code>fork()</code>, loading and unloading of libraries, and other events.</p>
<h2 id="deleting">
<span class="hash">#</span>
<a href="#deleting" class="header-link">Deleting</a>
</h2>
<p>Breakpoints can be either deleted in two ways, using the <code>delete</code> or <code>clear</code> commands. The <code>delete</code> command accepts breakpoint identifiers or if none are given, deletes all breakpoints:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">delete</span> breakpoint_list
<span class="kt">(gdb)</span> <span class="nb">delete</span> <span class="c"># deletes all breakpoints</span>
</code></pre></figure>
<p>The <code>clear</code> command accepts arguments similar to the <code>break</code> command. If no argument is given, it deletes the breakpoint at the next instruction that GDB will execute, which is useful for deleting the breakpoint that GDB just reached:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">clear</span> <span class="c"># delete breakpoint that was just reached</span>
</code></pre></figure><h2 id="disabling">
<span class="hash">#</span>
<a href="#disabling" class="header-link">Disabling</a>
</h2>
<p>The <code>disable</code> command is like the <code>delete</code> command in its arguments, but it simply disables breakpoints instead of removing them. Like the <code>delete</code> command, if no argument is provided, it disables all breakpoints.</p>

<p>The <code>enable</code> command is the opposite of the <code>disable</code> command. The <code>enable</code> command can provide <code>tbreak</code>-like functionality with <code>enable once</code>, which enables a list of breakpoints and then disables them once they&#39;re reached.</p>
<h2 id="conditionals">
<span class="hash">#</span>
<a href="#conditionals" class="header-link">Conditionals</a>
</h2>
<p>A condition can be associated with a breakpoint, using the <code>contidion</code> command, so that execution only pauses at it if it satisfies the condition. The condition can refer to variables local to the scope of the breakpoint. For example, the following places a condition on breakpoint #1 so that it only breaks if <code>num_y</code> is <code>1</code>:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">condition</span> <span class="mh">3</span> i <span class="o">==</span> <span class="mh">10</span>
</code></pre></figure>
<p>This condition also could have been provided to the <code>break</code> command itself as follows:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> <span class="mh">3</span> <span class="nb">if</span> i <span class="o">==</span> <span class="mh">10</span>
</code></pre></figure>
<p>A condition can be removed from an existing breakpoint as well:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">cond</span> <span class="mh">3</span>
</code></pre></figure>
<p>Pretty much any valid C conditional statement can be used, where true is non-zero and false is zero. This includes equality, logical, and inequality operators, bitwise and shift operators, arithmetic operators, and functions that are linked into the program.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> <span class="mh">180</span> <span class="nb">if</span> string <span class="o">==</span> NULL &amp;&amp; i &lt; <span class="mh">0</span>
<span class="kt">(gdb)</span> <span class="nb">break</span> test.c:<span class="mh">34</span> <span class="nb">if</span> (x &amp; y) <span class="o">==</span> <span class="mh">1</span>
<span class="kt">(gdb)</span> <span class="nb">break</span> myfunc <span class="nb">if</span> i % (j + <span class="mh">3</span>) !<span class="o">=</span> <span class="mh">0</span>
<span class="kt">(gdb)</span> <span class="nb">break</span> test.c:myfunc <span class="nb">if</span> !check_variable_sanity(i)
<span class="kt">(gdb)</span> <span class="nb">break</span> <span class="mh">44</span> <span class="nb">if</span> strlen(mystring) <span class="o">==</span> <span class="mh">0</span>
</code></pre></figure>
<p><strong>Note</strong> that when using a library function or other externally-linked function that provides no debugging symbols, the result of the function will be interpreted as an integer. This can lead to misinterpretations, such as:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">print</span> cos(<span class="mh">0</span>.<span class="mh">0</span>)
<span class="nv">$1</span> <span class="o">=</span> <span class="mh">14368</span>
</code></pre></figure>
<p>This can be alleviated if necessary by defining a GDB convenience variable with the necessary type information for the function in question:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> <span class="nv">$p</span> <span class="o">=</span> (double (*) (double))cos
<span class="kt">(gdb)</span> <span class="nb">ptype</span> <span class="nv">$p</span>
type <span class="o">=</span> double (*)()
<span class="kt">(gdb)</span> <span class="nb">p</span> cos(<span class="mh">3</span>.<span class="mh">14159265</span>)
<span class="nv">$2</span> <span class="o">=</span> <span class="mh">14368</span>
<span class="kt">(gdb)</span> <span class="nb">p</span> <span class="nv">$p</span>(<span class="mh">3</span>.<span class="mh">14159265</span>)
<span class="nv">$4</span> <span class="o">=</span> -<span class="mh">1</span>
</code></pre></figure><h2 id="command-lists">
<span class="hash">#</span>
<a href="#command-lists" class="header-link">Command Lists</a>
</h2>
<p>It&#39;s possible to define a list of commands to be run as soon as a particular breakpoint is triggered using the <code>commands</code> command which takes the following form. If the first command in the list is the <code>silent</code> command, it&#39;ll suppress information about the breakpoint whenever it&#39;s triggered.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">commands</span> breakpoint-identifier
<span class="kt">&gt;</span> <span class="nb">command</span>
<span class="kt">&gt;</span> <span class="nb">end</span>
</code></pre></figure>
<p>Commands can be removed from a breakpoint by redefining an empty command list.</p>

<p>It&#39;s possible to define macros---sets of commands---with the <code>define</code> command. Its form is similar to <code>commands</code>&#39; but its first argument is the name of the macro. The arguments are accessible as <code>$argn</code> where <code>n</code> is anywhere from <code>0</code> to <code>9</code>. Macro arguments aren&#39;t comma separated. Useful macros can be placed in the startup file and referenced within GDB. The command <code>show user</code> can be used to list all macros.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">define</span> print_and_go
<span class="kt">&gt;</span> <span class="nb">printf</span> <span class="nv">$arg0</span>, <span class="nv">$arg1</span>
<span class="kt">&gt;</span> <span class="nb">continue</span>
<span class="kt">&gt;</span> <span class="nb">end</span>
</code></pre></figure>
<p>Commands can also include if conditions.</p>
<h2 id="watchpoints">
<span class="hash">#</span>
<a href="#watchpoints" class="header-link">Watchpoints</a>
</h2>
<p>A <em>watchpoint</em>, set with <code>watch</code>, can be thought of as being attached to an expression, such that it gets triggered when the result of that expression changes. Setting a watchpoint on a variable causes the debugger to pause execution at the point when the memory location of that variable changes. For example, to watch the <code>z</code> variable:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">watch</span> z
</code></pre></figure>
<p>More powerful watchpoints can be established that are based on conditions related to the variable in question. For example, to watch for when <code>z</code> becomes greater than <code>28</code>:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">watch</span> (z &gt; <span class="mh">28</span>)
</code></pre></figure>
<p>There is also <code>rwatch</code> which triggers when a variable is read, and <code>awatch</code> which triggers when a variable is read <em>or</em> written.</p>

<p>Watchpoints are deleted as soon as any variable in the expression goes out of scope, requiring one to re-establish them the next time that function is called, if necessary. This can be automated by a command on a breakpoint in the relevant scope that establishes the watchpoint.</p>
<h2 id="signals">
<span class="hash">#</span>
<a href="#signals" class="header-link">Signals</a>
</h2>
<p>It&#39;s possible to avoid the pausing of execution or printing a warning when signals are received by having GDB handle them with the <code>handle</code> command. For example, to avoid stopping and printing a warning when <code>SIGUSR</code> is received:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">handle</span> SIGUSR<span class="mh">1</span> nostop noprint
</code></pre></figure><h2 id="information">
<span class="hash">#</span>
<a href="#information" class="header-link">Information</a>
</h2>
<p>The <code>info breakpoints</code> command can provide a summary of the various breakpoints that have been established and their properties. The breakpoint&#39;s <em>disposition</em> refers to what will happen to it the next time it&#39;s reached.</p>
<h1 id="executing">
<span class="hash">#</span>
<a href="#executing" class="header-link">Executing</a>
</h1>
<p>A key thing to remember is that whatever line GDB is currently at has <em>not</em> been executed yet.</p>
<h2 id="stepping">
<span class="hash">#</span>
<a href="#stepping" class="header-link">Stepping</a>
</h2>
<p>Single-stepping is possible with the <code>next</code> command, where a execution proceeds one original-source-code-line (e.g. 1 C++ line) at a time. The <code>step</code> command is similar, but if the line is on a function call, it will enter that function&#39;s body if there are debugging symbols available for it, whereas <code>next</code> would step over it.</p>

<p>Both <code>step</code> and <code>next</code> accept optional arguments specifying how far to step.</p>
<h2 id="resuming">
<span class="hash">#</span>
<a href="#resuming" class="header-link">Resuming</a>
</h2>
<p>Execution can be resumed until the next breakpoint with the <code>continue</code> command. It accepts an optional argument <code>n</code> telling it to ignore the next <code>n</code> breakpoints.</p>

<p>The <code>finish</code> command instructs GDB to resume execution until just after the current stack frame finishes, i.e. until just after the current function call finishes. However, if there are any intervening breakpoints, GDB <em>will</em> pause at them.</p>

<p>The <code>until</code> command resumes execution until GDB reaches a machine instruction that has a higher memory address than the current one. Like <code>finish</code>, it pauses at intervening breakpoints. The <code>until</code> command is usually useful when used on loops. It also accepts arguments similar to <code>break</code>, which causes execution to continue until that location is reached.</p>

<p>The <code>advance</code> command continues to a specific location which is specified in the same form that <code>break</code> accepts. This essentially has the effect of continuing to a temporary breakpoint denoted by the location.</p>
<h1 id="inspecting">
<span class="hash">#</span>
<a href="#inspecting" class="header-link">Inspecting</a>
</h1>
<p>Inspecting the program&#39;s state at any point in its execution is usually the primary motivation for debugging and setting breakpoints, so I consider it one of the most important parts to learn.</p>
<h2 id="source">
<span class="hash">#</span>
<a href="#source" class="header-link">Source</a>
</h2>
<p>Source code can be shown by using the <code>list</code> command, which itself changes the file currently in focus by GDB, used for setting breakpoints and other things. When it&#39;s first run, <code>list</code> shows the 10 source lines centered around <code>main</code>. Subsequence <code>list</code> commands show the next 10 lines, stopping when the end is reached. The reverse, showing the previous 10 lines, can be done with <code>list -</code>. If <code>list</code> is given a number, it shows 10 source lines centered on that line number. This command can also accept a range of lines to print, where one of the endpoints can optionally be omitted.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">list</span>
<span class="kt">(gdb)</span> <span class="nb">list</span> -
<span class="kt">(gdb)</span> <span class="nb">list</span> <span class="mh">5</span>
<span class="kt">(gdb)</span> <span class="nb">list</span> ,<span class="mh">28</span>
<span class="kt">(gdb)</span> <span class="nb">list</span> <span class="mh">28</span>,
<span class="kt">(gdb)</span> <span class="nb">list</span> <span class="mh">21</span>,<span class="mh">25</span>
<span class="kt">(gdb)</span> <span class="nb">list</span> funcname
<span class="kt">(gdb)</span> <span class="nb">list</span> file.c:<span class="mh">12</span>
<span class="kt">(gdb)</span> <span class="nb">list</span> file.c:funcname
</code></pre></figure>
<p>The number of lines output by GDB when using <code>list</code> is by default 10, but this can be changed:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> listsize <span class="mh">5</span>
</code></pre></figure><h2 id="printing">
<span class="hash">#</span>
<a href="#printing" class="header-link">Printing</a>
</h2>
<p>Basic variables such as integers can be printed with the <code>print</code> command. More complicated types will be covered later on. It&#39;s also possible to print out individual array elements with regular index syntax.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">print</span> y[<span class="mh">0</span>]
<span class="nv">$1</span> <span class="o">=</span> <span class="mh">12</span>
</code></pre></figure>
<p>The <code>print</code> command has support for printing in a variety of different format, which is done with <code>p/fmt var</code> where <code>fmt</code> is any one of:</p>

<table>
<thead>
<tr>
<th style="text-align: left">Format</th>
<th style="text-align: left">Code</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: left">address</td>
<td style="text-align: left">a</td>
</tr>
<tr>
<td style="text-align: left">binary</td>
<td style="text-align: left">t</td>
</tr>
<tr>
<td style="text-align: left">char</td>
<td style="text-align: left">c</td>
</tr>
<tr>
<td style="text-align: left">decimal</td>
<td style="text-align: left">d</td>
</tr>
<tr>
<td style="text-align: left">float</td>
<td style="text-align: left">f</td>
</tr>
<tr>
<td style="text-align: left">hex</td>
<td style="text-align: left">x</td>
</tr>
<tr>
<td style="text-align: left">hex (left zero padded)</td>
<td style="text-align: left">z</td>
</tr>
<tr>
<td style="text-align: left">instruction</td>
<td style="text-align: left">i</td>
</tr>
<tr>
<td style="text-align: left">octal</td>
<td style="text-align: left">o</td>
</tr>
<tr>
<td style="text-align: left">unsigned decimal</td>
<td style="text-align: left">u</td>
</tr>
<tr>
<td style="text-align: left">string</td>
<td style="text-align: left">s</td>
</tr>
</tbody>
</table>

<p>There is also a <code>printf</code> function which behaves the same way as the function of the same name in C, but like <code>print</code> in GDB, the parentheses are optional.</p>

<p>This makes GDB much more preferable to actual <code>printf</code>-debugging which modifies the source code and is itself susceptible to bugs, or can even have unforeseen consequences.</p>

<p>Structures can be printed outright and their constituent data members will be displayed.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> *structptr
<span class="nv">$1</span> = {<span class="nv">val</span> = <span class="mh">12</span>, <span class="nv">left</span> = <span class="mh">0x8049698</span>, <span class="nv">right</span> = <span class="mh">0x0</span>}
</code></pre></figure>
<p>All of this information on one line can become difficult to read, in which case an alternative &quot;pretty printing&quot; scheme may be used which uses one struct member per-line:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> print pretty
<span class="kt">(gdb)</span> <span class="nb">p</span> *structptr
<span class="nv">$1</span> = {
  <span class="nv">val</span> = <span class="mh">12</span>,
  <span class="nv">left</span> = <span class="mh">0x8049698</span>,
  <span class="nv">right</span> = <span class="mh">0x0</span>
}
</code></pre></figure>
<p>Specific members can be printed individually by accessing the same way as one would in C/C++, both <code>-&gt;</code> and <code>.</code> can be used on pointers:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> structptr<span class="na">-&gt;val</span>
<span class="kt">(gdb)</span> <span class="nb">p</span> structptr.val
</code></pre></figure>
<p>The <code>display</code> command registers a variable for printing every time execution pauses. If no argument is passed, it lists all auto-displayed variables. Display directives can be disabled or enabled with the corresponding commands. To remove a display directive altogether, use the <code>undisplay</code> command:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">disable</span> display <span class="mh">1</span>
<span class="kt">(gdb)</span> <span class="nb">enable</span> display <span class="mh">1</span>
<span class="kt">(gdb)</span> <span class="nb">undisplay</span> <span class="mh">1</span>
</code></pre></figure>
<p>The <code>call</code> command can also be used to call a particular function when a breakpoint is triggered, which can be used for printing some state out using a function defined in the program, specialized for that task.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">commands</span> <span class="mh">2</span>
<span class="kt">&gt;</span> <span class="nb">printf</span> <span class="s">&quot;current tree is&quot;</span>
<span class="kt">&gt;</span> <span class="nb">call</span> printtree(root)
<span class="kt">&gt;</span> <span class="nb">end</span>
</code></pre></figure>
<p>The <code>x</code> command, for &quot;examine,&quot; can be used to examing memory at a given address.</p>

<p>A summary of information about the current frame can be obtained with the <code>info frame</code> command. More specifically, the <code>info args</code> command can show the values of the arguments passed to the current function, and the <code>info locals</code> command can show all of the variables local to the current stack frame.</p>

<p>The <code>ptype</code> command can be used to determine the type of a variable. When the type is a structure or a class, it can show the layout/definition.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">ptype</span> argc
type <span class="o">=</span> int
</code></pre></figure>
<p>A static array can be printed regularly with the <code>print</code> command:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-c"><span class="kt">int</span> <span class="n">x</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
</code></pre></figure><figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> x
</code></pre></figure>
<p>It&#39;s also possible to print sub-ranges of an array, for example 5 elements starting at element 3:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> x[<span class="mh">3</span>]@<span class="mh">5</span>
</code></pre></figure>
<p>Dynamically allocated arrays have to be dereferenced and GDB has to be instructed on how large they are. This takes the form <code>*ptr@size</code>.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</code></pre></figure><figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> *x@<span class="mh">6</span>
<span class="nv">$1</span> = {<span class="mh">0</span>, <span class="mh">0</span>, <span class="mh">0</span>, <span class="mh">12</span>, <span class="mh">0</span>, <span class="mh">0</span>}
</code></pre></figure><figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> <span class="kt">(int </span>[<span class="mh">6</span>]) *x
<span class="nv">$1</span> = {<span class="mh">0</span>, <span class="mh">0</span>, <span class="mh">0</span>, <span class="mh">12</span>, <span class="mh">0</span>, <span class="mh">0</span>}
</code></pre></figure><h2 id="call-stack-navigation">
<span class="hash">#</span>
<a href="#call-stack-navigation" class="header-link">Call Stack Navigation</a>
</h2>
<p>The runtime information immediately available to GDB is whatever is located on the current stack frame, determined by the current function call. Consider functions <code>A</code>, <code>B</code>, and <code>C</code>, where each one calls the next. If execution is paused within <code>C</code>, you can print values local to <code>C</code>&#39;s stack frame with typical commands like <code>print</code>. That is, if function <code>C</code> has local variable <code>j</code>, it can be printed with <code>print j</code>.</p>

<p>However, it&#39;s also possible to traverse the call stack as it is at any given moment, in order to bring a different frame into GDB&#39;s focus and therefore inspect that frame&#39;s state. The <code>frame</code> command allows traversal relative to the current function call&#39;s frame, which is referred to as frame <code>0</code>. For example, to go to the grand-parent&#39;s frame:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">frame</span> <span class="mh">2</span>
</code></pre></figure>
<p>GDB also provides simpler commands <code>up</code> and <code>down</code> for traversing relative to the currently focused stack frame.</p>

<p>The <code>backtrace</code> command shows the entire stack.</p>

<p>The command <code>where</code> can be used to determine where one is at any given moment.</p>
<h2 id="setting">
<span class="hash">#</span>
<a href="#setting" class="header-link">Setting</a>
</h2>
<p>It&#39;s possible to set the value of variables mid-execution using the <code>set</code> command, which provides no output from GDB. Variables can also be set using the print command, which follows the setting of the variable with printing out its new value:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> variable x <span class="o">=</span> <span class="mh">12</span>
<span class="kt">(gdb)</span> <span class="nb">print</span> x <span class="o">=</span> <span class="mh">12</span>
</code></pre></figure>
<p>There are also variables specific to GDB that can be created and used. For example, GDB has a <em>value history</em> which simply assigns the result of an entered command to an increasing variable name. This is similar to Scala&#39;s interpreter which assigns the expression result values to <code>res#</code>. These variables can be referenced in future commands. The <code>$</code> variable always refers to the previous result.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">p</span> tmp<span class="na">-&gt;left</span>
<span class="nv">$1</span> <span class="o">=</span> (<span class="kt">struct node *</span>) <span class="mh">0x80496a8</span>
<span class="kt">(gdb)</span> <span class="nb">p</span> *$
<span class="nv">$2</span> = {<span class="nv">val</span> = <span class="mh">5</span>, <span class="nv">left</span> = <span class="mh">0x0</span>, <span class="nv">right</span> = <span class="mh">0x0</span>}
</code></pre></figure>
<p>It&#39;s also possible to set environment variables within GDB:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> environment ENVVAR <span class="o">=</span> <span class="mh">3</span>
</code></pre></figure>
<p>Convenience variables can change values according to C rules. For example, given an array <code>w</code>, its elements can be iterated in GDB by creating a convenience variable that represents the iterations&#39; current index.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-c"><span class="kt">int</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">88</span><span class="p">};</span>
</code></pre></figure><figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">set</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mh">0</span>
<span class="kt">(gdb)</span> <span class="nb">p</span> w[<span class="nv">$i</span>++]
<span class="nv">$1</span> <span class="o">=</span> <span class="mh">12</span>
(gdb)
<span class="nv">$2</span> <span class="o">=</span> <span class="mh">5</span>
(gdb)
<span class="nv">$3</span> <span class="o">=</span> <span class="mh">88</span>
</code></pre></figure><h1 id="core-files">
<span class="hash">#</span>
<a href="#core-files" class="header-link">Core Files</a>
</h1>
<p>A core file contains a detailed description of the program&#39;s state when it crashed, such as the contents of the stack(s), CPU&#39;s registers, and values of statically allocated variables.</p>

<p>Usually when a core dump file is generated, it&#39;s placed in the current directory named <code>core</code> or some variation of it. It may be necessary to increase the shell&#39;s core dump resource limit with the command:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span><span class="nb">ulimit</span> -c unlimited
</code></pre></figure>
<p>On systems that use <a href="http://en.wikipedia.org/wiki/Systemd">systemd</a>, such as mine, these files are instead managed by systemd&#39;s journal; they won&#39;t show up in the current directory regardless of the resource limit. The helper program <code>systemd-coredumpctl</code> can be used to extract the core dumps from the journal into individual files:</p>

<p><strong>June 23rd, 2014</strong>: It seems this may no longer be the case as of arch package <a href="https://projects.archlinux.org/svntogit/packages.git/commit/trunk?h=packages/systemd&amp;id=20f65088398622522bb33e6f53dfde83d31a2208">systemd-214-2</a>.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="c"># based on PID</span>
<span class="nv">$ </span>systemd-coredumpctl dump PID -o outname

<span class="c"># based on binary name</span>
<span class="nv">$ </span>systemd-coredumpctl dump urxvt -o outname
</code></pre></figure>
<p>Core files are useful from a debugging perspective because they provide a starting point for dissecting the program to determine the cause of the crash. They are more useful than simply re-running the program within GDB because it would be that the bug that caused the crash occurs rarely and randomly.</p>

<p>Core files can be loaded into GDB by supplying them as a second argument, after the name of the program that generated the core file:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>gdb crasher corefile
</code></pre></figure>
<p>Once loaded, we can run a <code>backtrace</code> to determine the point at which the program crashed. The <code>frame</code> command can be used to navigate the call stack, and typical inspecting commands can be used to analyze the program&#39;s state as it was when it crashed. Breakpoints and similar tools can be established, then the program can be run normally.</p>
<h1 id="threads">
<span class="hash">#</span>
<a href="#threads" class="header-link">Threads</a>
</h1>
<p>GDB announces whenever new threads are created. The <code>info threads</code> command can provide summary information about what each of the threads are doing. An asterisk denotes the currently focused thread. Note that some threads may be internal to the threading implementation, such as a Pthreads manager thread.</p>

<p>It&#39;s possible to switch GDB&#39;s focus to a different thread with the <code>thread</code> command, which takes as argument the thread identifier denoted in <code>info threads</code>.</p>

<p>It&#39;s also possible to provide thread disambiguators to the <code>break</code> command, to pause execution when a specific thread reaches a breakpoint:</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">break</span> linenr thread threadid <span class="nb">if</span> condition
</code></pre></figure><h1 id="abbreviations">
<span class="hash">#</span>
<a href="#abbreviations" class="header-link">Abbreviations</a>
</h1>
<p>Many commands have abbreviations which are simpler to enter:</p>

<table>
  <thead>
    <tr class="header">
      <th>Command</th>
    </tr>
  </thead>
  <tbody>
    <tr class="odd">
      <td><strong>b</strong>ack<strong>t</strong>race</td>
    </tr>
    <tr class="even">
      <td><strong>b</strong>reak</td>
    </tr>
    <tr class="odd">
      <td><strong>cond</strong>ition</td>
    </tr>
    <tr class="even">
      <td><strong>c</strong>ontinue</td>
    <tr class="odd">
      <td><strong>dis</strong>able</td>
    <tr class="even">
      <td><strong>disp</strong>lay</td>
    <tr class="odd">
      <td><strong>ena</strong>ble</td>
    <tr class="even">
      <td><strong>fin</strong>ish</td>
    <tr class="odd">
      <td><strong>i</strong>nfo</td>
    <tr class="even">
      <td><strong>n</strong>ext</td>
    <tr class="odd">
      <td><strong>p</strong>rint</td>
    <tr class="even">
      <td><strong>pt</strong>ype</td>
    <tr class="odd">
      <td><strong>q</strong>uit</td>
    <tr class="even">
      <td><strong>r</strong>un</td>
    <tr class="odd">
      <td><strong>s</strong>tep</td>
    <tr class="even">
      <td><strong>tb</strong>reak</td>
    <tr class="odd">
      <td><strong>undisp</strong>lay</td>
    <tr class="even">
      <td><strong>u</strong>ntil</td>
  </tbody>
</table>
<h1 id="valgrind">
<span class="hash">#</span>
<a href="#valgrind" class="header-link">Valgrind</a>
</h1>
<p>It&#39;s <a href="http://billiob.net/blog/20140330_vgdb.html">possible</a> to load a GDB session inside of a valgrind session.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-bash"><span class="nv">$ </span>valgrind --vgdb<span class="o">=</span>yes --vgdb-error<span class="o">=</span><span class="m">0</span> ./prog
<span class="nv">$ </span>gdb ./prog
<span class="o">(</span>gdb<span class="o">)</span> target remote <span class="p">|</span> vgdb
</code></pre></figure>
<p>It&#39;s possible to then send commands to valgrind from within GDB using the <code>monitor</code> command. The <code>leak_check</code> valgrind command for example can be used when paused at a GDB breakpoint to manually perform a memory leak check. Other useful valgrind commands are <code>block_list</code> and <code>who_points_at</code>.</p>
<figure class="codeblock">
<pre>
<code class="highlight language-gdb"><span class="kt">(gdb)</span> <span class="nb">monitor</span> help
<span class="kt">(gdb)</span> <span class="nb">breakpoint</span> <span class="mh">6</span>
<span class="kt">(gdb)</span> <span class="nb">monitor</span> leak_check
</code></pre></figure></div>
  <div class="meta">
    <div class="meta-component"><i class="fa fa-calendar fa-fw"></i> February 18, 2014</div>
    <div class="meta-component"><i class="fa fa-code-fork fa-fw"></i> <a href="https://github.com/blaenk/site/commits/master/input/notes/gdb.markdown">History</a><span class="hash">, <a href="https://github.com/blaenk/site/commit/dc6ff87" title="new table marker syntax; no need for metadata

This means there's no need to separate the toc marker from its
configuration, i.e. alignment. This never should've been necessary.

This has the nice side-effect of naturally invalidating the cache when
the toc marker is moved around or its alignment is changed.
">dc6ff87</a></span></div>
    <div class="meta-component"><i class="fa fa-pencil fa-fw"></i> <a href="..">Notes</a></div>
  </div>
</article>



    
    <footer id="footer">
  <div id="social">
    <a href="https://github.com/blaenk" title="github"><i class="fa fa-github-alt"></i></a>
    &middot;
    <a href="http://stackoverflow.com/users/101090/jorge-israel-pena" title="stackoverflow"><i class="fa fa-stack-overflow"></i></a>
    &middot;
    <a href="https://twitter.com/blaenk" title="twitter"><i class="fa fa-twitter"></i></a>
    &middot;
    <a href="mailto:jorge.israel.p@gmail.com" title="email"><i class="fa fa-envelope"></i></a>
    &middot;
    <a href="/rss.xml" title="feed"><i class="fa fa-rss-square"></i></a>
  </div>
  <!-- <div id="credit">
    Designed by <a href="http://www.blaenkdenum.com">Jorge Israel Peña</a>
  </div> -->
</footer>


<!-- this should instead be something like connectWS("{{{path}}}") -->


<script type="text/javascript">
  jQuery(function (){
    var ws = new WebSocket('ws://' + window.location.hostname + ':9160/notes/gdb.markdown');

    ws.onmessage = function (e) {
      var content = jQuery('article .entry-content');
      content.html(e.data);

      window.refresh();

      MathJax.Hub.Queue(["Typeset", MathJax.Hub, jQuery('article .entry-content')[0]]);

      if (window.jumpDown)
        window.scrollDown();
    };
  });
</script>




<!-- google analytics -->
<script async="true" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37339861-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!--MathJax CDN-->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    messageStyle: "none"
  });

  MathJax.Hub.Register.MessageHook('End Process', function() {
    jQuery('#MathJax_Font_Test').empty();
    jQuery('.MathJax_Display').parent().addClass('mathjax');
  });
</script>

  </div>
</body>
</html>
